<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信公众号开发 | 前端知识手册</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/favicon.png">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?504b4691c0952ac562a0f3c8877cfe6d";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
            </script>
    <meta name="description" content="前端知识手册 html css js JavaScript 移动端 微信 wechat vue vuepress markdown git">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="theme-color" content="red">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.2f6ab4d5.css" as="style"><link rel="preload" href="/assets/js/app.82b7948e.js" as="script"><link rel="preload" href="/assets/js/3.83738f31.js" as="script"><link rel="preload" href="/assets/js/1.513fb8f2.js" as="script"><link rel="preload" href="/assets/js/46.7136c260.js" as="script"><link rel="prefetch" href="/assets/js/10.7aa331af.js"><link rel="prefetch" href="/assets/js/11.eedd0e21.js"><link rel="prefetch" href="/assets/js/12.8acafb06.js"><link rel="prefetch" href="/assets/js/13.dcd97f97.js"><link rel="prefetch" href="/assets/js/14.2faaa968.js"><link rel="prefetch" href="/assets/js/15.68276f5a.js"><link rel="prefetch" href="/assets/js/16.67792858.js"><link rel="prefetch" href="/assets/js/17.4db4315d.js"><link rel="prefetch" href="/assets/js/18.accf1e38.js"><link rel="prefetch" href="/assets/js/19.2be115c4.js"><link rel="prefetch" href="/assets/js/20.5769e233.js"><link rel="prefetch" href="/assets/js/21.638453af.js"><link rel="prefetch" href="/assets/js/22.35fbcb4a.js"><link rel="prefetch" href="/assets/js/23.0c1b26e5.js"><link rel="prefetch" href="/assets/js/24.d2b2b87e.js"><link rel="prefetch" href="/assets/js/25.9651473b.js"><link rel="prefetch" href="/assets/js/26.9b2aec5c.js"><link rel="prefetch" href="/assets/js/27.655b3197.js"><link rel="prefetch" href="/assets/js/28.ee59d142.js"><link rel="prefetch" href="/assets/js/29.13cd2ed5.js"><link rel="prefetch" href="/assets/js/30.dd4d13de.js"><link rel="prefetch" href="/assets/js/31.2bf99d83.js"><link rel="prefetch" href="/assets/js/32.0fabfbb1.js"><link rel="prefetch" href="/assets/js/33.54d34599.js"><link rel="prefetch" href="/assets/js/34.657d675f.js"><link rel="prefetch" href="/assets/js/35.4f99edb4.js"><link rel="prefetch" href="/assets/js/36.d0bf0a91.js"><link rel="prefetch" href="/assets/js/37.761fb1e9.js"><link rel="prefetch" href="/assets/js/38.c2b37fff.js"><link rel="prefetch" href="/assets/js/39.a14b1315.js"><link rel="prefetch" href="/assets/js/4.601e569f.js"><link rel="prefetch" href="/assets/js/40.f20178e4.js"><link rel="prefetch" href="/assets/js/41.114e1347.js"><link rel="prefetch" href="/assets/js/42.d4171a24.js"><link rel="prefetch" href="/assets/js/43.19564c4c.js"><link rel="prefetch" href="/assets/js/44.097a202b.js"><link rel="prefetch" href="/assets/js/45.dff7e4db.js"><link rel="prefetch" href="/assets/js/47.96bff3e6.js"><link rel="prefetch" href="/assets/js/5.dcee5a4e.js"><link rel="prefetch" href="/assets/js/6.422a8e9d.js"><link rel="prefetch" href="/assets/js/7.e6239e5f.js"><link rel="prefetch" href="/assets/js/8.912ca784.js"><link rel="prefetch" href="/assets/js/9.2d7845b1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2f6ab4d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>前端知识手册</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>前端知识手册 html css js JavaScript 移动端 微信 wechat vue vuepress markdown git</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端知识手册</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/whjway" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>37</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="https://github.com/whjway" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快捷入口</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/quick/site.html" class="sidebar-link">常用网站</a></li><li><a href="/quick/best-practice.html" class="sidebar-link">最佳实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/knowledge-system.html" class="sidebar-link">前端 知识体系</a></li><li><a href="/frontend/choiceness.html" class="sidebar-link">前端 精选文章</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ECMAScript6</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化-基础建设</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>微信生态</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wechat/wechat.html" aria-current="page" class="active sidebar-link">微信公众号开发</a></li><li><a href="/wechat/choiceness.html" class="sidebar-link">微信生态 精选文章</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>微信公众号开发</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">微信公众号开发</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="微信公众平台测试账号申请"><a href="#微信公众平台测试账号申请" class="header-anchor">#</a> <a href="https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index" target="_blank" rel="noopener noreferrer">微信公众平台测试账号申请<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <h3 id="踩坑"><a href="#踩坑" class="header-anchor">#</a> 踩坑</h3> <ol><li>接口配置信息和 JS 接口安全域名 跟后端商定好!!!</li> <li>扫测试号二维码</li> <li>体验接口权限表, 开启对应服务!!!!!</li></ol> <h2 id="微信-js-sdk"><a href="#微信-js-sdk" class="header-anchor">#</a> <a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html" target="_blank" rel="noopener noreferrer">微信 JS-SDK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <blockquote><p>微信 JS-SDK 是微信公众平台 面向网页开发者提供的基于微信内的网页开发工具包。<br>
通过使用微信 JS-SDK，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。<br>
此文档面向网页开发者介绍微信 JS-SDK 如何使用及相关注意事项。</p></blockquote> <h3 id="踩坑-2"><a href="#踩坑-2" class="header-anchor">#</a> 踩坑</h3> <ol start="0"><li>微信授权</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 跳转到微信静默授权页 获取code（code会放到回调url的参数里面）
 */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APPID</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/config&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">goGetCodePage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token constant">REDIRECT_URI</span> <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
  <span class="token constant">STATE</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  scope <span class="token operator">=</span> <span class="token string">&quot;snsapi_userinfo&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://open.weixin.qq.com/connect/oauth2/authorize?appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">APPID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;redirect_uri=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>
    <span class="token constant">REDIRECT_URI</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;response_type=code&amp;scope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scope<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;state=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">STATE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#wechat_redirect</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> href<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS 接口安全域名”</li> <li>Vue spa (history 模式) 切换页面也需要重新 config</li> <li>IOS 下分享校验的地址 是第一次打开页面的地址</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>pageUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>pageUrl <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// IOS下分享校验的地址 是第一次打开页面的地址</span>
<span class="token keyword">const</span> validUrl <span class="token operator">=</span> isIOS <span class="token operator">?</span> window<span class="token punctuation">.</span>pageUrl <span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li><p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#66" target="_blank" rel="noopener noreferrer">附录 5-常见错误及解决方法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>按照参考文档排查问题, 有签名算法校验页面,排查步骤</li> <li>invalid signature 签名错误 大概率是 url 问题</li> <li>permission denied 该公众号没有权限使用这个 JSAPI 要么 config 没配置对应权限,要么 config 失败 二次分享等都不能正常使用</li></ul></li> <li><p>微信内支付</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 下单后接口返回对应参数 paySign不建议暴露</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> pack<span class="token punctuation">,</span> appId<span class="token punctuation">,</span> timeStamp<span class="token punctuation">,</span> nonceStr<span class="token punctuation">,</span> signType<span class="token punctuation">,</span> paySign <span class="token punctuation">}</span> <span class="token operator">=</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>orderInfo<span class="token punctuation">.</span>payData<span class="token punctuation">.</span>jsApiPayData<span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>weChatPayParams <span class="token operator">=</span> <span class="token punctuation">{</span>
  appId<span class="token punctuation">,</span>
  timeStamp<span class="token punctuation">,</span>
  nonceStr<span class="token punctuation">,</span>
  signType<span class="token punctuation">,</span>
  paySign<span class="token punctuation">,</span>
  <span class="token keyword">package</span><span class="token operator">:</span> pack<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 公众号支付</span>
WeixinJSBridge<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">&quot;getBrandWCPayRequest&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>weChatPayParams<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>err_msg <span class="token operator">==</span> <span class="token string">&quot;get_brand_wcpay_request:ok&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用以上方式判断前端返回,微信团队郑重提示：</span>
    <span class="token comment">//res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。</span>
    <span class="token comment">// 支付成功</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callBackSuccessJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 支付失败</span>
    Toast<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;支付失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="微信支付"><a href="#微信支付" class="header-anchor">#</a> <a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_1" target="_blank" rel="noopener noreferrer">微信支付<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <blockquote><p>H5 支付是指商户在微信客户端外的移动端网页展示商品或服务，用户在前述页面确认使用微信支付时，商户发起本服务呼起微信客户端进行支付。主要用于触屏版的手机浏览器请求微信支付的场景。可以方便的从外部浏览器唤起微信支付。</p></blockquote> <h3 id="踩坑-3"><a href="#踩坑-3" class="header-anchor">#</a> 踩坑</h3> <ol><li>浏览器内支付重定向,设计好交互流程.</li> <li>客户端内,建议使用 APP 支付,如果使用 H5 支付需要考虑是否支持唤醒微信,交互流程
<ul><li>最后有单独结果页,支付重定向后跳到结果页轮询查支付结果</li></ul></li></ol> <h3 id="测试环境配置"><a href="#测试环境配置" class="header-anchor">#</a> 测试环境配置</h3> <h4 id="方法-1-推荐"><a href="#方法-1-推荐" class="header-anchor">#</a> 方法 1(推荐)</h4> <ol><li>host 配置</li></ol> <div class="language- extra-class"><pre class="language-text"><code>//使用host-switch 管理工具(https://github.com/oldj/SwitchHosts/blob/master/README_cn.md)
host-switch add test.weichat.com
//直接在hosts文件新增
127.0.0.1 test.weichat.com
</code></pre></div><ol start="2"><li>本地服务</li></ol> <div class="language- extra-class"><pre class="language-text"><code>devServer: {
    disableHostCheck: true,
    port: 80, //1 微信授权重定向不支持带端口的访问域名 2 配置80端口，就可以只输入网址 3 sudo 启动项目
  },
</code></pre></div><ol start="3"><li>使用
直接访问 <code>test.weichat.com</code></li></ol> <h4 id="方法-2"><a href="#方法-2" class="header-anchor">#</a> 方法 2</h4> <ol><li>安装 nginx 并且配置代理<br> <code>cd /usr/local/etc/nginx/servers</code>
将 nginx 的配置文件 xxx.conf 放到你的 nginx servers 目录下：
然后在 nginx 配置文件中 include</li></ol> <div class="language- extra-class"><pre class="language-text"><code>//有可能你的配置文件中已经包含这行配置，请忽略
include servers/*
// or
include servers/*.conf

</code></pre></div><div class="language-shell script extra-class"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name   test.weichat.com<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
         <span class="token comment"># root   html;</span>
         index  index.html index.htm<span class="token punctuation">;</span>
         proxy_pass  http://127.0.0.1:3000<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
    location /pay <span class="token punctuation">{</span>
        <span class="token comment"># root   html;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
        proxy_pass  http://127.0.0.1:3000/pay/<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ol start="2"><li>host 配置</li></ol> <div class="language- extra-class"><pre class="language-text"><code>//使用host-switch 管理工具(https://github.com/oldj/SwitchHosts/blob/master/README_cn.md)
host-switch add test.weichat.com
//直接在hosts文件新增
127.0.0.1 test.weichat.com
</code></pre></div><ol start="3"><li>本地服务</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
   disableHostCheck<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
   <span class="token comment">// public: &quot;18840.dev.fygnh.com&quot;,</span>
   host<span class="token operator">:</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span>
   port<span class="token operator">:</span> <span class="token string">&quot;3000&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="支付宝支付"><a href="#支付宝支付" class="header-anchor">#</a> <a href="https://opendocs.alipay.com/open/203/105285" target="_blank" rel="noopener noreferrer">支付宝支付<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <blockquote><p>支付宝支付 真不错!!!!</p></blockquote> <h3 id="踩坑-4"><a href="#踩坑-4" class="header-anchor">#</a> 踩坑</h3> <ol><li>添加支付成功后的回调, 入参增加 return_url</li> <li>使用方法, 支付宝返回 form 表单</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>aliPayForm <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>return_url 最大长度 256,不然安卓支付成功后会报错</li></ol> <h3 id="沙箱联调指南"><a href="#沙箱联调指南" class="header-anchor">#</a> <a href="https://opendocs.alipay.com/open/203/107096" target="_blank" rel="noopener noreferrer">沙箱联调指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <ol><li>不能唤醒 app 支付,填写账号支付即可</li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/9/2 下午5:11:20</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mobile/choiceness.html" class="prev">
            移动端 精选文章
          </a></span> <span class="next"><a href="/wechat/choiceness.html">
            微信生态 精选文章
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/wechat/wechat.html#微信公众平台测试账号申请" class="sidebar-link reco-side-微信公众平台测试账号申请" data-v-cb1513f6>微信公众平台测试账号申请</a></li><li class="level-3" data-v-cb1513f6><a href="/wechat/wechat.html#踩坑" class="sidebar-link reco-side-踩坑" data-v-cb1513f6>踩坑</a></li><li class="level-2" data-v-cb1513f6><a href="/wechat/wechat.html#微信-js-sdk" class="sidebar-link reco-side-微信-js-sdk" data-v-cb1513f6>微信 JS-SDK</a></li><li class="level-3" data-v-cb1513f6><a href="/wechat/wechat.html#踩坑-2" class="sidebar-link reco-side-踩坑-2" data-v-cb1513f6>踩坑</a></li><li class="level-2" data-v-cb1513f6><a href="/wechat/wechat.html#微信支付" class="sidebar-link reco-side-微信支付" data-v-cb1513f6>微信支付</a></li><li class="level-3" data-v-cb1513f6><a href="/wechat/wechat.html#踩坑-3" class="sidebar-link reco-side-踩坑-3" data-v-cb1513f6>踩坑</a></li><li class="level-3" data-v-cb1513f6><a href="/wechat/wechat.html#测试环境配置" class="sidebar-link reco-side-测试环境配置" data-v-cb1513f6>测试环境配置</a></li><li class="level-2" data-v-cb1513f6><a href="/wechat/wechat.html#支付宝支付" class="sidebar-link reco-side-支付宝支付" data-v-cb1513f6>支付宝支付</a></li><li class="level-3" data-v-cb1513f6><a href="/wechat/wechat.html#踩坑-4" class="sidebar-link reco-side-踩坑-4" data-v-cb1513f6>踩坑</a></li><li class="level-3" data-v-cb1513f6><a href="/wechat/wechat.html#沙箱联调指南" class="sidebar-link reco-side-沙箱联调指南" data-v-cb1513f6>沙箱联调指南</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.82b7948e.js" defer></script><script src="/assets/js/3.83738f31.js" defer></script><script src="/assets/js/1.513fb8f2.js" defer></script><script src="/assets/js/46.7136c260.js" defer></script>
  </body>
</html>
